INCLUDE_DIR   = @includedir@@versiondir@
LIB_DIR       = @libdir@@versiondir@
SRC_DIR       = @srcdir@@versiondir@
TOOLS_DIR     = @libdir@@versiondir@/tools/lib

LOAD_EXT      = @load_ext@
O             = @o@

PERL          = @perl@
RM_F          = @rm_f@
CP            = @cp@
CAT           = @cat@
PARROT        = @bindir@/parrot@exe@
PBC_TO_EXE    = @bindir@/pbc_to_exe$(EXE)
TOOLS_DIR     = @libdir@/tools
PERL_LIB      = $(TOOLS_DIR)/lib
NQP           = $(PARROT) $(LIB_DIR)/languages/nqp/nqp.pbc
PBC_TO_EXE    = @bindir@/pbc_to_exe

PARROT_DYNEXT = $(LIB_DIR)/dynext
PERL6GRAMMAR  = $(LIB_DIR)/library/PGE/Perl6Grammar.pbc
PCT           = $(LIB_DIR)/PCT.pbc
PMC2C         = $(PERL) $(PARROT_TOOLS_DIR)/build/pmc2c.pl

GROUP         = pla_group
PMC_DIR       = src/pmc
DYNPMC        = $(PMC_DIR)/$(GROUP)$(LOAD_EXT)

PMC2C_INCLUDES = --include $(PMC_DIR) --include $(SRC_DIR) --include $(SRC_DIR)/pmc

PMC_SOURCES = \
    $(PMC_DIR)/NumMatrix2D.pmc

$(DYNPMC): $(PMC_SOURCES) src/binder/bind.c src/binder/bind.h
    $(PMC2C) --no-lines --dump $(PMC2C_INCLUDES) $(PMC_SOURCES)
    $(PMC2C) --no-lines --c $(PMC2C_INCLUDES) $(PMC_SOURCES)
    $(PMC2C) --no-lines --library $(GROUP) --c $(PMC_SOURCES)
    $(CC) -c @cc_o_out@$(GROUP)$(O) -I$(PMC_DIR) $(CINCLUDES) $(CFLAGS) $(GROUP).c
    cd $(PMC_DIR) && $(CC) -c $(CINCLUDES) $(CFLAGS) *.c
    cd src/binder && $(CC) -c @cc_o_out@bind$(O) -I$(PMC_DIR) $(CINCLUDES) $(CFLAGS) bind.c
    $(LD) @ld_out@$(DYNPMC) $(GROUP)$(O) src/pmc/*$(O) src/binder/bind$(O) $(LINKARGS)

# This is a listing of all targets, that are meant to be called by users
help:
	@echo ""
	@echo "Following targets are available for the user:"
	@echo ""
	@echo "  all:               This is the default."
	@echo "Testing:"
	@echo "  test:              Run the test suite."
	@echo ""
#	@echo "Cleaning:"
#	@echo "  clean:             Basic cleaning up."
#	@echo "  realclean:         Removes also files generated by 'Configure.pl'"
#	@echo "  distclean:         Removes also anything built, in theory"
#	@echo ""
	@echo "Misc:"
	@echo "  help:              Print this help message."
	@echo ""

# Local variables:
#   mode: makefile
# End:
# vim: ft=make:

